
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>janus.openmm_wrapper &#8212; janus 1.0 documentation</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">janus 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for janus.openmm_wrapper</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">simtk.openmm.app</span> <span class="k">as</span> <span class="nn">OM_app</span>
<span class="kn">import</span> <span class="nn">simtk.openmm</span> <span class="k">as</span> <span class="nn">OM</span>
<span class="kn">import</span> <span class="nn">simtk.unit</span> <span class="k">as</span> <span class="nn">OM_unit</span>
<span class="kn">from</span> <span class="nn">.mm_wrapper</span> <span class="k">import</span> <span class="n">MM_wrapper</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>


<div class="viewcode-block" id="OpenMM_wrapper"><a class="viewcode-back" href="../../source/janus.openmm_wrapper.html#janus.openmm_wrapper.OpenMM_wrapper">[docs]</a><span class="k">class</span> <span class="nc">OpenMM_wrapper</span><span class="p">(</span><span class="n">MM_wrapper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper class that calls OpenMM</span>
<span class="sd">    to obtain molecular mechanics information and </span>
<span class="sd">    take steps in a molecular dynamics simulation. </span>
<span class="sd">    Class inherits from MM_wrapper.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes an OpenMM wrapper class with a set of parameters for </span>
<span class="sd">        running OpenMM. Creates an OpenMM pdb object using the given pdb_file</span>
<span class="sd">        and forcefield object using the given forcefield</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        param : dict containing parameters for molecular mechanics computations.</span>
<span class="sd">                Individual parameters include:</span>
<span class="sd">                - mm_pdb_file: a pdb file that contains the system of interest</span>
<span class="sd">                - mm_forcefield: the name of the forcefield to use, default is amber99sb.xml</span>
<span class="sd">                - mm_water_forcefield: the name of the forcefield to use for water, default is tip3p.xml</span>
<span class="sd">                - is_periodic: whether to treat the system periodically, default is False</span>
<span class="sd">                - step_size: step size to integrate system in picoseconds, </span>
<span class="sd">                             default is 0.002*OM_unit.picoseconds</span>
<span class="sd">                - integrator&quot; : which integrator to use for simulation, default is Langevin</span>
<span class="sd">                - fric_coeff&quot; : friction coefficient to couple the system to heat bath in inverse</span>
<span class="sd">                                picoseconds, default is 1/OM_unit.picosecond</span>
<span class="sd">                - temp: the temperature at which the simulation runs in kelvin, default is 300*OM_unit.kelvin</span>
<span class="sd">                - nonbondedMethod: method for nonbonded interactions, default is OM_app.NoCutoff</span>
<span class="sd">                - nonbondedCutoff: cutoff distance for nonbonded interactions in nanometers,</span>
<span class="sd">                                   default is &quot;1*OM_unit.nanometer&quot;,</span>
<span class="sd">                - constraints: which bonds and angles implemented with constraints,</span>
<span class="sd">                               default is OM_app.HBonds</span>
<span class="sd">                - rigid_water: whether water is treated as rigid, default is True</span>
<span class="sd">                - removeCMMotion: whether to include a CMMotionRemover, default is True</span>
<span class="sd">                - ignoreExternalBonds: whether to ignore external bonds when matching residues to templates,</span>
<span class="sd">                                       default is True</span>
<span class="sd">                - flexibleConstraints: whether to add parameters for constrained parameters,</span>
<span class="sd">                                       default is False</span>
<span class="sd">                - hydrogenMass: the mass to use for hydrogen atoms bonded to heavy atoms,</span>
<span class="sd">                                default is False</span>
<span class="sd">                - residueTemplates: allows user to specify a template for a residue,</span>
<span class="sd">                                    default is empty dict {}</span>
<span class="sd">                - switchDistance: the distance to turn on potential energy switching function for </span>
<span class="sd">                                  Lennard-Jones interactions. Default is None</span>

<span class="sd">                For more information about these pararmeters and </span>
<span class="sd">                other possible parameter values consult docs.openmm.org</span>
<span class="sd">                </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        An OpenMM_wrapper object</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        mm_wrapper = OpenMM_wrapper(param)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="s2">&quot;OpenMM&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ff</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;mm_forcefield&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ff_water</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;mm_water_forcefield&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_periodic</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;is_periodic&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">temp</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step_size</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;step_size&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fric_coeff</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;fric_coeff&#39;</span><span class="p">])</span>

        <span class="c1"># instantiate OpenMM pdb object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdb</span> <span class="o">=</span> <span class="n">OpenMM_wrapper</span><span class="o">.</span><span class="n">create_pdb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdb_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># instantiate OpenMM forcefield object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forcefield</span> <span class="o">=</span> <span class="n">OM_app</span><span class="o">.</span><span class="n">ForceField</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff_water</span><span class="p">)</span>

<div class="viewcode-block" id="OpenMM_wrapper.initialize"><a class="viewcode-back" href="../../source/janus.openmm_wrapper.html#janus.openmm_wrapper.OpenMM_wrapper.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">embedding_method</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls compute_mm to get information for the system</span>
<span class="sd">        of interest in its initial state and saves the simulation </span>
<span class="sd">        object and information dictionary returned by compute_mm</span>
<span class="sd">    </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        embedding_method: what embedding method to use for initialization.</span>
<span class="sd">                          If &#39;Mechanical&#39;, all forces are included</span>
<span class="sd">                          If &#39;Electrostatic&#39;, all coulomic forces are excluded</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        initialize(&#39;Mechanical&#39;)</span>
<span class="sd">        initialize(&#39;Electrostatic&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">embedding_method</span> <span class="o">==</span> <span class="s1">&#39;Mechanical&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_simulation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_info</span> <span class="o">=</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">compute_mm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdb</span><span class="o">.</span><span class="n">topology</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdb</span><span class="o">.</span><span class="n">positions</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_simulation</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">embedding_method</span> <span class="o">==</span> <span class="s1">&#39;Electrostatic&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_simulation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_info</span> <span class="o">=</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">compute_mm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdb</span><span class="o">.</span><span class="n">topology</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdb</span><span class="o">.</span><span class="n">positions</span><span class="p">,</span> <span class="n">include_coulomb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_simulation</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;only mechanical and electrostatic embedding schemes implemented at this time&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenMM_wrapper.take_step"><a class="viewcode-back" href="../../source/janus.openmm_wrapper.html#janus.openmm_wrapper.OpenMM_wrapper.take_step">[docs]</a>    <span class="k">def</span> <span class="nf">take_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the system with forces from qmmm </span>
<span class="sd">        and takes a simulation step</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        forces: dict of forces(particle index: forces) in au/bohr to </span>
<span class="sd">                be updated in custom qmmm force and fed into simulation</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        take_step(forces)</span>
<span class="sd">        take_step({0: [0.0, 0.0, 0.0]})</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">force</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">coord</span> <span class="o">*=</span> <span class="n">MM_wrapper</span><span class="o">.</span><span class="n">au_bohr_to_kjmol_nm</span>             <span class="c1"># convert this back to openmm units</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qmmm_force</span><span class="o">.</span><span class="n">setParticleParameters</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">coord</span><span class="p">)</span>  <span class="c1"># need to figure out if the first 2 parameters always the same or not</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">qmmm_force</span><span class="o">.</span><span class="n">updateParametersInContext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_simulation</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>  <span class="c1"># update forces with qmmm force</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_simulation</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>                                             <span class="c1"># take a step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_main_info</span><span class="p">()</span>                                    <span class="c1"># get the energy and gradients after step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_info</span><span class="p">[</span><span class="s1">&#39;positions&#39;</span><span class="p">]</span>                             <span class="c1"># get positions after step</span></div>
    

<div class="viewcode-block" id="OpenMM_wrapper.get_main_info"><a class="viewcode-back" href="../../source/janus.openmm_wrapper.html#janus.openmm_wrapper.OpenMM_wrapper.get_main_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_main_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the information for the system of interest</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dictionary with information like energy and gradient </span>
<span class="sd">        for the system of interest</span>
<span class="sd">    </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        info = get_main_info()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="n">OpenMM_wrapper</span><span class="o">.</span><span class="n">get_state_info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_simulation</span><span class="p">,</span> <span class="n">main_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenMM_wrapper.compute_mm"><a class="viewcode-back" href="../../source/janus.openmm_wrapper.html#janus.openmm_wrapper.OpenMM_wrapper.compute_mm">[docs]</a>    <span class="k">def</span> <span class="nf">compute_mm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topology</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">include_coulomb</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">return_system</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">return_simulation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">link_atoms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minimize</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets information about a set of molecules as defined in the pdb, including energy, positions, forces</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        topology: an OpenMM topology object</span>
<span class="sd">        positions: an OpenMM Vec3 vector containing </span>
<span class="sd">                   the positions of the system in nm</span>
<span class="sd">        include_coulomb: whether to include coulombic interactions. </span>
<span class="sd">                         &#39;all&#39; (default) includes coulombic forces for all particles,</span>
<span class="sd">                         &#39;no_link&#39; excludes coulombic forces for link atoms,</span>
<span class="sd">                         &#39;only&#39; excludes all other forces for all atoms,</span>
<span class="sd">                         None excludes coulombic forces for all particles.</span>
<span class="sd">        initialize: bool to specifying whether the main system is being initialized.</span>
<span class="sd">        return_system: a bool to specify whether to return the OpenMM system object. </span>
<span class="sd">                       Default is True. </span>
<span class="sd">        return_simulation: a bool to specify whether to return the OpenMM simulation object.</span>
<span class="sd">                       Default is True. </span>
<span class="sd">        link_atoms: if included as a list with include_coulomb=&#39;no_link&#39;, specifies which </span>
<span class="sd">                    atoms to remove coulombic forces from. Default is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        system, simulation, state </span>
<span class="sd">        state: A dictionary with state information</span>
<span class="sd">        system: OpenMM system object returned unless return_system=False</span>
<span class="sd">        simulation: OpenMM simulation object returned unless return_simulation=False</span>


<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        system, simulation, state = compute_mm(top, pos)</span>
<span class="sd">        state = compute_mm(top, pos, return_simulation=False, return_system=False)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Create an OpenMM system from an object&#39;s topology</span>
        <span class="k">if</span> <span class="n">initialize</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">OM_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_openmm_system</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">include_coulomb</span><span class="p">,</span> <span class="n">link_atoms</span><span class="p">,</span><span class="n">initialize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">OM_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_openmm_system</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">include_coulomb</span><span class="p">,</span> <span class="n">link_atoms</span><span class="p">)</span>

        <span class="c1"># Create an OpenMM simulation from the openmm system, topology, and positions.</span>
        <span class="n">simulation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_openmm_simulation</span><span class="p">(</span><span class="n">OM_system</span><span class="p">,</span> <span class="n">topology</span><span class="p">,</span> <span class="n">positions</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">minimize</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">simulation</span><span class="o">.</span><span class="n">minimizeEnergy</span><span class="p">()</span>

        <span class="c1"># Calls openmm wrapper to get information specified</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">OpenMM_wrapper</span><span class="o">.</span><span class="n">get_state_info</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span>
                                      <span class="n">energy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                      <span class="n">positions</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                      <span class="n">forces</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">return_system</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">return_simulation</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">OM_system</span><span class="p">,</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">state</span>
        <span class="k">elif</span> <span class="n">return_system</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">return_simulation</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">OM_system</span><span class="p">,</span> <span class="n">state</span>
        <span class="k">elif</span> <span class="n">return_system</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">return_simulation</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">simulation</span><span class="p">,</span> <span class="n">state</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">state</span></div>


<div class="viewcode-block" id="OpenMM_wrapper.create_openmm_system"><a class="viewcode-back" href="../../source/janus.openmm_wrapper.html#janus.openmm_wrapper.OpenMM_wrapper.create_openmm_system">[docs]</a>    <span class="k">def</span> <span class="nf">create_openmm_system</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topology</span><span class="p">,</span> <span class="n">include_coulomb</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">link_atoms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls OpenMM to create an OpenMM System object give a topology,</span>
<span class="sd">        forcefield, and other paramters as given in input</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        topology: an OpenMM topology object</span>
<span class="sd">        include_coulomb: whether to include coulombic interactions. </span>
<span class="sd">                         &#39;all&#39; (default) includes coulombic forces for all particles,</span>
<span class="sd">                         &#39;no_link&#39; excludes coulombic forces for link atoms,</span>
<span class="sd">                         &#39;only&#39; excludes all other forces for all atoms,</span>
<span class="sd">                         None excludes coulombic forces for all particles.</span>
<span class="sd">        link_atoms: if included as a list with include_coulomb=&#39;no_link&#39;, specifies which </span>
<span class="sd">                    atoms to remove coulombic forces from. Default is None.</span>
<span class="sd">        initialize: bool to specifying whether the main system is being initialized.</span>
<span class="sd">                    If True, this will create a custom force to store qmmm forces. </span>
<span class="sd">                    default is false</span>

<span class="sd">        TODO: need to put nonbond and nonbond_cutoff back but not doing for now</span>
<span class="sd">            because need non-periodic system. Other parameters are also needed</span>
<span class="sd">            also, expand forcefield to take not openmm built in</span>
<span class="sd">                but customized as well</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        An OpenMM system object</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        openmm_sys = create_openmm_system(topology)</span>
<span class="sd">        openmm_sys = create_openmm_system(top, include_coulomb=&#39;no_link&#39;, link_atoms=[0,1,2])</span>
<span class="sd">        openmm_sys = create_openmm_system(top, include_coulomb=&#39;only&#39;)</span>
<span class="sd">        openmm_sys = create_openmm_system(top, initialize=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check to see if there are unmatched residues in pdb, create residue templates if there are</span>
        <span class="n">unmatched</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcefield</span><span class="o">.</span><span class="n">getUnmatchedResidues</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unmatched</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_new_residue_template</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_periodic</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">openmm_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcefieldcreateSystem</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span>
                                            <span class="n">constraints</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">openmm_system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcefield</span><span class="o">.</span><span class="n">createSystem</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span>
                                            <span class="n">nonbondedMethod</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;nonbondedMethod&#39;</span><span class="p">]),</span>
                                            <span class="n">nonbondedCutoff</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;nonbondedCutoff&#39;</span><span class="p">]),</span>
                                            <span class="n">constraints</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;constraints&#39;</span><span class="p">]),</span>
                                            <span class="n">residueTemplates</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;residueTemplates&#39;</span><span class="p">],</span>
                                            <span class="n">hydrogenMass</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;hydrogenMass&#39;</span><span class="p">]),</span>
                                            <span class="n">switchDistance</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;switchDistance&#39;</span><span class="p">]),</span>
                                            <span class="n">rigid_water</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;rigid_water&#39;</span><span class="p">],</span>
                                            <span class="n">removeCMMotion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;removeCMMotion&#39;</span><span class="p">],</span>
                                            <span class="n">flexibleConstraints</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;flexibleConstraints&#39;</span><span class="p">],</span>
                                            <span class="n">ignoreExternalBonds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;ignoreExternalBonds&#39;</span><span class="p">])</span>


        <span class="k">if</span> <span class="n">initialize</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>                                             <span class="c1"># this is for the initialization of the entire system</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qmmm_force</span> <span class="o">=</span> <span class="n">OM</span><span class="o">.</span><span class="n">CustomExternalForce</span><span class="p">(</span><span class="s2">&quot;-x*fx-y*fy-z*fz&quot;</span><span class="p">)</span>    <span class="c1"># define a custom force for adding qmmm gradients</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qmmm_force</span><span class="o">.</span><span class="n">addPerParticleParameter</span><span class="p">(</span><span class="s1">&#39;fx&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qmmm_force</span><span class="o">.</span><span class="n">addPerParticleParameter</span><span class="p">(</span><span class="s1">&#39;fy&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qmmm_force</span><span class="o">.</span><span class="n">addPerParticleParameter</span><span class="p">(</span><span class="s1">&#39;fz&#39;</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">openmm_system</span><span class="o">.</span><span class="n">getNumParticles</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qmmm_force</span><span class="o">.</span><span class="n">addParticle</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]))</span>
            
            <span class="n">openmm_system</span><span class="o">.</span><span class="n">addForce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmmm_force</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">main_charges</span> <span class="o">=</span> <span class="p">[</span><span class="n">openmm_system</span><span class="o">.</span><span class="n">getForce</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">getParticleParameters</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">OM_unit</span><span class="o">.</span><span class="n">elementary_charge</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">openmm_system</span><span class="o">.</span><span class="n">getNumParticles</span><span class="p">())]</span>

        <span class="c1"># If in electrostatic embedding scheme need to get a system without coulombic interactions</span>
        <span class="k">if</span> <span class="n">include_coulomb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># get the nonbonded force</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_charge_zero</span><span class="p">(</span><span class="n">openmm_system</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">include_coulomb</span> <span class="o">==</span> <span class="s1">&#39;no_link&#39;</span> <span class="ow">and</span> <span class="n">link_atoms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_charge_zero</span><span class="p">(</span><span class="n">openmm_system</span><span class="p">,</span> <span class="n">link_atoms</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">include_coulomb</span> <span class="o">==</span> <span class="s1">&#39;only&#39;</span><span class="p">:</span>
        <span class="c1"># Remove Bond, Angle, and Torsion forces to leave only nonbonded forces</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">openmm_system</span><span class="o">.</span><span class="n">getNumForces</span><span class="p">()):</span>             
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">openmm_system</span><span class="o">.</span><span class="n">getForce</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">OM</span><span class="o">.</span><span class="n">NonbondedForce</span><span class="p">:</span>     
                    <span class="n">openmm_system</span><span class="o">.</span><span class="n">removeForce</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>                              
            <span class="bp">self</span><span class="o">.</span><span class="n">set_LJ_zero</span><span class="p">(</span><span class="n">openmm_system</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">openmm_system</span></div>

<div class="viewcode-block" id="OpenMM_wrapper.set_charge_zero"><a class="viewcode-back" href="../../source/janus.openmm_wrapper.html#janus.openmm_wrapper.OpenMM_wrapper.set_charge_zero">[docs]</a>    <span class="k">def</span> <span class="nf">set_charge_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">OM_system</span><span class="p">,</span> <span class="n">link_atoms</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes the coulombic forces by setting charges of </span>
<span class="sd">        specified atoms to zero</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        OM_system : an OpenMM system object</span>
<span class="sd">        link_atoms : list of link_atoms to set the charge to zero,</span>
<span class="sd">                     if link_atoms is None (default), the charge of </span>
<span class="sd">                     all particles in the system will be set to zero</span>
<span class="sd">    </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        set_charge_zero(system)</span>
<span class="sd">        set_charge_zero(system, link_atoms=[0,1,2])</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">force</span> <span class="ow">in</span> <span class="n">OM_system</span><span class="o">.</span><span class="n">getForces</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">force</span><span class="p">)</span> <span class="ow">is</span> <span class="n">OM</span><span class="o">.</span><span class="n">NonbondedForce</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">link_atoms</span><span class="p">:</span>
                    <span class="c1"># set the charge of link atoms to 0 so the coulomb energy is zero</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">link_atoms</span><span class="p">:</span>
                        <span class="n">a</span> <span class="o">=</span> <span class="n">force</span><span class="o">.</span><span class="n">getParticleParameters</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                        <span class="n">force</span><span class="o">.</span><span class="n">setParticleParameters</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">epsilon</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># set the charge of all particles to 0 so the coulomb energy is zero</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">force</span><span class="o">.</span><span class="n">getNumParticles</span><span class="p">()):</span>
                        <span class="n">a</span> <span class="o">=</span> <span class="n">force</span><span class="o">.</span><span class="n">getParticleParameters</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                        <span class="n">force</span><span class="o">.</span><span class="n">setParticleParameters</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">epsilon</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span></div>

<div class="viewcode-block" id="OpenMM_wrapper.set_LJ_zero"><a class="viewcode-back" href="../../source/janus.openmm_wrapper.html#janus.openmm_wrapper.OpenMM_wrapper.set_LJ_zero">[docs]</a>    <span class="k">def</span> <span class="nf">set_LJ_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">OM_system</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes the Lennard-Jones (van der Waals) force from the system</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        OM_system : an OpenMM system object</span>
<span class="sd">    </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        set_LJ_zero(system)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">force</span> <span class="ow">in</span> <span class="n">OM_system</span><span class="o">.</span><span class="n">getForces</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">force</span><span class="p">)</span> <span class="ow">is</span> <span class="n">OM</span><span class="o">.</span><span class="n">NonbondedForce</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">force</span><span class="o">.</span><span class="n">getNumParticles</span><span class="p">()):</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="n">force</span><span class="o">.</span><span class="n">getParticleParameters</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">force</span><span class="o">.</span><span class="n">setParticleParameters</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span></div>
        

<div class="viewcode-block" id="OpenMM_wrapper.create_new_residue_template"><a class="viewcode-back" href="../../source/janus.openmm_wrapper.html#janus.openmm_wrapper.OpenMM_wrapper.create_new_residue_template">[docs]</a>    <span class="k">def</span> <span class="nf">create_new_residue_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topology</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new OpeMM residue template when there is no matching residue </span>
<span class="sd">        and registers it into self.forcefield forcefield object.</span>
<span class="sd">        Note: currently, if there is unmatched name, currently only checks original </span>
<span class="sd">              unmodified residue, N-terminus form, and C-terminus form. </span>
<span class="sd">              This may not be robust.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        topology: an OpenMM topology object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        create_new_residue_template(topology)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">template</span><span class="p">,</span> <span class="n">unmatched_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcefield</span><span class="o">.</span><span class="n">generateTemplatesForUnmatchedResidues</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>

        <span class="c1"># Loop through list of unmatched residues</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loop through list of unmatched residues&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">res</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unmatched_res</span><span class="p">):</span>
            <span class="n">res_name</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">name</span>                             <span class="c1"># get the name of the original unmodifed residue</span>
            <span class="n">n_res_name</span> <span class="o">=</span> <span class="s1">&#39;N&#39;</span> <span class="o">+</span> <span class="n">res</span><span class="o">.</span><span class="n">name</span>                     <span class="c1"># get the name of the N-terminus form of original residue</span>
            <span class="n">c_res_name</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span> <span class="o">+</span> <span class="n">res</span><span class="o">.</span><span class="n">name</span>                     <span class="c1"># get the name of the C-terminus form of original residue</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Modified_&#39;</span> <span class="o">+</span> <span class="n">res_name</span>                   <span class="c1"># assign new name</span>
            <span class="n">template</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

        <span class="c1"># loop through all atoms in modified template and all atoms in orignal template to assign atom type</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;loop through all atoms in modified template and all atoms in orignal template to assign atom type&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">template</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">atom2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcefield</span><span class="o">.</span><span class="n">_templates</span><span class="p">[</span><span class="n">res_name</span><span class="p">]</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">atom2</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                    <span class="n">atom</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">atom2</span><span class="o">.</span><span class="n">type</span>
            <span class="c1"># the following is for when there is a unmatched name, check the N and C terminus residues</span>
            <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check n&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">atom3</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcefield</span><span class="o">.</span><span class="n">_templates</span><span class="p">[</span><span class="n">n_res_name</span><span class="p">]</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">atom3</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                        <span class="n">atom</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">atom3</span><span class="o">.</span><span class="n">type</span>
            <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check c&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">atom4</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcefield</span><span class="o">.</span><span class="n">_templates</span><span class="p">[</span><span class="n">c_res_name</span><span class="p">]</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">atom4</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                        <span class="n">atom</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">atom4</span><span class="o">.</span><span class="n">type</span>

        <span class="c1"># override existing modified residues with same name</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcefield</span><span class="o">.</span><span class="n">_templates</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;override existing modified residues with same name&#39;</span><span class="p">)</span>
            <span class="n">template</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">overrideLevel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcefield</span><span class="o">.</span><span class="n">_templates</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">overrideLevel</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># register the new template to the forcefield object</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;register the new template to the forcefield object&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forcefield</span><span class="o">.</span><span class="n">registerResidueTemplate</span><span class="p">(</span><span class="n">template</span><span class="p">[</span><span class="n">i</span><span class="p">])</span></div>


<div class="viewcode-block" id="OpenMM_wrapper.create_openmm_simulation"><a class="viewcode-back" href="../../source/janus.openmm_wrapper.html#janus.openmm_wrapper.OpenMM_wrapper.create_openmm_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">create_openmm_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">openmm_system</span><span class="p">,</span> <span class="n">topology</span><span class="p">,</span> <span class="n">positions</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an OpenMM simulation object given</span>
<span class="sd">        an OpenMM system, topology, and positions</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        openmm_system: OpenMM system object</span>
<span class="sd">        topology: an OpenMM topology object</span>
<span class="sd">        positions: an OpenMM Vec3 vector containing </span>
<span class="sd">                   the positions of the system in nm</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        an OpenMM simulation object</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        create_open_simulation(openmm_sys, top, pos) </span>
<span class="sd">        create_open_simulation(openmm_sys, pdb.topology. pdb.positions)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;integrator&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Langevin&#39;</span><span class="p">:</span>
            <span class="n">integrator</span> <span class="o">=</span> <span class="n">OM</span><span class="o">.</span><span class="n">LangevinIntegrator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fric_coeff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;only Langevin integrator supported currently&#39;</span><span class="p">)</span>

        <span class="n">simulation</span> <span class="o">=</span> <span class="n">OM_app</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">openmm_system</span><span class="p">,</span> <span class="n">integrator</span><span class="p">)</span>
        <span class="n">simulation</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">setPositions</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">simulation</span></div>

<div class="viewcode-block" id="OpenMM_wrapper.get_state_info"><a class="viewcode-back" href="../../source/janus.openmm_wrapper.html#janus.openmm_wrapper.OpenMM_wrapper.get_state_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_state_info</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span>
                       <span class="n">main_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">energy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">positions</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">velocity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">forces</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">parameters</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">param_deriv</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">periodic_box</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">groups_included</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets information like the kinetic and potential energy,</span>
<span class="sd">        positions, forces, and topology from an OpenMM state.</span>
<span class="sd">        Some of these may need to be made accessible to user.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        simulation : an OpenMM simulation object</span>
<span class="sd">        main_info : a bool for specifying whether to return the topology of the system</span>
<span class="sd">        energy : a bool for specifying whether to get the energy,</span>
<span class="sd">                 returns in hartrees(a.u.), default is true.</span>
<span class="sd">        positions : a bool for specifying whether to get the positions,</span>
<span class="sd">                    returns in nanometers, default is true</span>
<span class="sd">        velocity : a bool for specifying whether to get the velocities, default is false</span>
<span class="sd">        forces : a bool for specifying whether to get the forces acting</span>
<span class="sd">                on the system, returns as numpy array in jk/mol/nm, as well as the gradients,</span>
<span class="sd">                in au/bohr, default is true</span>
<span class="sd">        parameters : a bool for specifying whether to get the parameters</span>
<span class="sd">                    of the state, default is false.</span>
<span class="sd">        param_deriv : a bool for specifying whether to get the parameter</span>
<span class="sd">                    derivatives of the state, default is false</span>
<span class="sd">        periodic_box : a bool for whether to translate the positions so the</span>
<span class="sd">                    center of every molecule lies in the same periodic box, default is false</span>
<span class="sd">        groups : a set of indices for which force groups to include when computing</span>
<span class="sd">                forces and energies. Default is all groups</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A dictionary with information specified by parameters.</span>
<span class="sd">        Keys include &#39;energy&#39;, &#39;potential&#39;, &#39;kinetic&#39;, &#39;forces&#39;,</span>
<span class="sd">        &#39;gradients&#39;, &#39;topology&#39;</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        get_state_info(sim)</span>
<span class="sd">        get_state_info(sim, groups_included=set{0,1,2})</span>
<span class="sd">        get_state_info(sim, positions=True, forces=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">state</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">getState</span><span class="p">(</span><span class="n">getEnergy</span><span class="o">=</span><span class="n">energy</span><span class="p">,</span>
                                            <span class="n">getPositions</span><span class="o">=</span><span class="n">positions</span><span class="p">,</span>
                                            <span class="n">getVelocities</span><span class="o">=</span><span class="n">velocity</span><span class="p">,</span>
                                            <span class="n">getForces</span><span class="o">=</span><span class="n">forces</span><span class="p">,</span>
                                            <span class="n">getParameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
                                            <span class="n">getParameterDerivatives</span><span class="o">=</span><span class="n">param_deriv</span><span class="p">,</span>
                                            <span class="n">enforcePeriodicBox</span><span class="o">=</span><span class="n">periodic_box</span><span class="p">,</span>
                                            <span class="n">groups</span><span class="o">=</span><span class="n">groups_included</span><span class="p">)</span>

        <span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># divide by unit to give value without units, then convert value to atomic units</span>
        <span class="k">if</span> <span class="n">energy</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">values</span><span class="p">[</span><span class="s1">&#39;potential&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">getPotentialEnergy</span><span class="p">()</span><span class="o">/</span><span class="n">OM_unit</span><span class="o">.</span><span class="n">kilojoule_per_mole</span>
            <span class="n">values</span><span class="p">[</span><span class="s1">&#39;potential&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">MM_wrapper</span><span class="o">.</span><span class="n">kjmol_to_au</span>
            <span class="n">values</span><span class="p">[</span><span class="s1">&#39;kinetic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">getKineticEnergy</span><span class="p">()</span><span class="o">/</span><span class="n">OM_unit</span><span class="o">.</span><span class="n">kilojoule_per_mole</span>
            <span class="n">values</span><span class="p">[</span><span class="s1">&#39;kinetic&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">MM_wrapper</span><span class="o">.</span><span class="n">kjmol_to_au</span>
            <span class="n">values</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;potential&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;kinetic&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">positions</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">values</span><span class="p">[</span><span class="s1">&#39;positions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">getPositions</span><span class="p">(</span><span class="n">asNumpy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">/</span><span class="n">OM_unit</span><span class="o">.</span><span class="n">nanometer</span>

        <span class="k">if</span> <span class="n">forces</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">values</span><span class="p">[</span><span class="s1">&#39;forces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">getForces</span><span class="p">(</span><span class="n">asNumpy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">OM_unit</span><span class="o">.</span><span class="n">kilojoule_per_mole</span><span class="o">/</span><span class="n">OM_unit</span><span class="o">.</span><span class="n">nanometer</span><span class="p">)</span>
            <span class="n">values</span><span class="p">[</span><span class="s1">&#39;gradients&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;forces&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">MM_wrapper</span><span class="o">.</span><span class="n">kjmol_nm_to_au_bohr</span>   

        <span class="k">if</span> <span class="n">main_info</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># need to check if the topology actually updates </span>
            <span class="n">values</span><span class="p">[</span><span class="s1">&#39;topology&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">topology</span>

        <span class="k">return</span> <span class="n">values</span></div>

<div class="viewcode-block" id="OpenMM_wrapper.write_pdb"><a class="viewcode-back" href="../../source/janus.openmm_wrapper.html#janus.openmm_wrapper.OpenMM_wrapper.write_pdb">[docs]</a>    <span class="k">def</span> <span class="nf">write_pdb</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a pdb file from an OpenMM modeller</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mod : OpenMM modeller object</span>
<span class="sd">        filename : string of file to write to</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        write_pdb(mod, &#39;input.pdb&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">OM</span><span class="o">.</span><span class="n">PDBFile</span><span class="o">.</span><span class="n">writeFile</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="n">topology</span><span class="p">,</span> <span class="n">mod</span><span class="o">.</span><span class="n">positions</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">))</span></div>
 
<div class="viewcode-block" id="OpenMM_wrapper.create_pdb"><a class="viewcode-back" href="../../source/janus.openmm_wrapper.html#janus.openmm_wrapper.OpenMM_wrapper.create_pdb">[docs]</a>    <span class="k">def</span> <span class="nf">create_pdb</span><span class="p">(</span><span class="n">mm_pdb_file</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Creates an OpenMM PDB object</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            mm_pdb_file: string of pdb file name</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            OpenMM PDB object</span>

<span class="sd">            Examples</span>
<span class="sd">            --------</span>
<span class="sd">            model = create_openmm_pdb(&#39;input.pdb&#39;)</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">pdb</span> <span class="o">=</span> <span class="n">OM_app</span><span class="o">.</span><span class="n">PDBFile</span><span class="p">(</span><span class="n">mm_pdb_file</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pdb</span></div>


<div class="viewcode-block" id="OpenMM_wrapper.create_modeller"><a class="viewcode-back" href="../../source/janus.openmm_wrapper.html#janus.openmm_wrapper.OpenMM_wrapper.create_modeller">[docs]</a>    <span class="k">def</span> <span class="nf">create_modeller</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qm_atoms</span><span class="p">,</span> <span class="n">keep_qm</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes a OpenMM modeller object based on given geometry</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        keep_qm : a bool of whether to keep the qm atoms in the</span>
<span class="sd">                modeller or delete them.</span>
<span class="sd">                The default is to make a modeller without the qm atoms</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A OpenMM modeller object</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        modeller = self.make_modeller()</span>
<span class="sd">        modeller = self.make_modeller(keep_qm=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">modeller</span> <span class="o">=</span> <span class="n">OM_app</span><span class="o">.</span><span class="n">Modeller</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdb</span><span class="o">.</span><span class="n">topology</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdb</span><span class="o">.</span><span class="n">getPositions</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">keep_qm</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">OpenMM_wrapper</span><span class="o">.</span><span class="n">delete_atoms</span><span class="p">(</span><span class="n">modeller</span><span class="p">,</span> <span class="n">qm_atoms</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">keep_qm</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">OpenMM_wrapper</span><span class="o">.</span><span class="n">keep_atoms</span><span class="p">(</span><span class="n">modeller</span><span class="p">,</span> <span class="n">qm_atoms</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">modeller</span></div>

<div class="viewcode-block" id="OpenMM_wrapper.keep_atoms"><a class="viewcode-back" href="../../source/janus.openmm_wrapper.html#janus.openmm_wrapper.OpenMM_wrapper.keep_atoms">[docs]</a>    <span class="k">def</span> <span class="nf">keep_atoms</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">atoms</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Acts on an OpenMM Modeller object to keep the specified</span>
<span class="sd">            atoms in the MM system and deletes everything else</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            model : OpenMM Modeller object</span>
<span class="sd">            atoms : list of atoms to keep in an OpenMM Modeller object</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            None</span>

<span class="sd">            Examples</span>
<span class="sd">            --------</span>
<span class="sd">            keep_atom(mod, [0,1])</span>
<span class="sd">            keep_atom(mod, [&#39;O&#39;, &#39;H&#39;])</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">lis</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">atoms</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
                        <span class="n">lis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
                        <span class="n">lis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
            <span class="n">model</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span></div>


<div class="viewcode-block" id="OpenMM_wrapper.delete_atoms"><a class="viewcode-back" href="../../source/janus.openmm_wrapper.html#janus.openmm_wrapper.OpenMM_wrapper.delete_atoms">[docs]</a>    <span class="k">def</span> <span class="nf">delete_atoms</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">atoms</span><span class="p">):</span>
         <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Delete specified atoms from an OpenMM Modeller object</span>

<span class="sd">         Parameters</span>
<span class="sd">         ----------</span>
<span class="sd">         model : OpenMM Modeller object</span>
<span class="sd">         atoms : list of atom IDs (int) or atom names (str) to delete</span>
<span class="sd">                     an OpenMM Modeller object</span>

<span class="sd">         Returns</span>
<span class="sd">         -------</span>
<span class="sd">         None</span>

<span class="sd">         Examples</span>
<span class="sd">         --------</span>
<span class="sd">         delete_atoms(model, [0, 3, 5])</span>
<span class="sd">         delete_atoms(model, [&#39;Cl&#39;])</span>
<span class="sd">         &quot;&quot;&quot;</span>
         <span class="n">lis</span> <span class="o">=</span> <span class="p">[]</span>
         <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">atoms</span><span class="p">():</span>
             <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                 <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
                     <span class="n">lis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
             <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                 <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
                     <span class="n">lis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
         <span class="n">model</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span></div>

<div class="viewcode-block" id="OpenMM_wrapper.get_main_charges"><a class="viewcode-back" href="../../source/janus.openmm_wrapper.html#janus.openmm_wrapper.OpenMM_wrapper.get_main_charges">[docs]</a>    <span class="k">def</span> <span class="nf">get_main_charges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the MM point charges for the system of interest</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of charges</span>
<span class="sd">    </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        charges = get_main_charges()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_charges</span></div></div>

</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">janus 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Boyi Zhang.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.0.
    </div>
  </body>
</html>